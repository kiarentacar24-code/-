<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¡¯ë°ë Œí„°ì¹´ ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  
  <!-- SheetJS CDN for Excel parsing -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  
  <style>
    :root{
      --bg:#f6f7fb;
      --panel:#ffffff;
      --card:#ffffff;
      --line:#e2e8f0;
      --text:#0f172a;
      --text-muted:#64748b;
      --accent:#e60012;
      --accent-light:#fff1f2;
      --accent2:#2563eb;
      --accent2-light:#dbeafe;
      --success:#10b981;
      --success-light:#d1fae5;
      --shadow: 0 2px 8px rgba(15,23,42,.08);
      --shadow-lg: 0 10px 24px rgba(15,23,42,.12);
      --radius:12px;
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    }
    
    *{box-sizing:border-box; margin:0; padding:0;}
    
    body{
      background: linear-gradient(135deg, #f6f7fb 0%, #e9ecef 100%);
      color:var(--text);
      font-family:var(--font);
      line-height:1.6;
    }

    .wrap{
      max-width:1400px; 
      margin:0 auto; 
      padding:20px 16px 40px;
    }

    /* ===== HEADER ===== */
    header{
      position:sticky; 
      top:0; 
      z-index:100;
      backdrop-filter: blur(12px);
      background: rgba(255,255,255,.95);
      border-bottom:2px solid var(--line);
      box-shadow: var(--shadow);
    }
    
    .topbar{
      display:flex; 
      gap:16px; 
      align-items:center; 
      justify-content:space-between; 
      padding:16px 20px; 
      max-width:1400px; 
      margin:0 auto;
    }
    
    .brand{
      display:flex; 
      align-items:center; 
      gap:16px;
    }
    
    .logo-container{
      width:160px; 
      height:52px;
      background: linear-gradient(135deg, #ffffff, #f8f9fa);
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px 12px;
      box-shadow: 0 2px 8px rgba(230,0,18,.1);
      border:1px solid rgba(230,0,18,.12);
    }
    
    .logoImg{
      width:100%; 
      height:100%; 
      object-fit:contain;
    }
    
    .title{
      line-height:1.3;
    }
    
    .title h1{
      font-size:18px; 
      font-weight:800; 
      letter-spacing:-.3px;
      color:var(--text);
    }
    
    .title p{
      margin:4px 0 0; 
      font-size:13px; 
      color:var(--text-muted);
      font-weight:500;
    }

    .status-indicator{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 14px;
      background:var(--accent-light);
      border:1px solid var(--accent);
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      color:var(--accent);
    }
    
    .status-indicator.loading{
      background:var(--accent2-light);
      border-color:var(--accent2);
      color:var(--accent2);
    }
    
    .status-indicator.success{
      background:var(--success-light);
      border-color:var(--success);
      color:var(--success);
    }

    /* ===== SEARCH & FILTERS ===== */
    .search-section{
      max-width:1400px;
      margin:0 auto;
      padding:16px 20px;
      background:#fff;
      border-bottom:1px solid var(--line);
    }
    
    .search-input{
      width:100%; 
      border:2px solid var(--line); 
      background:#fff; 
      padding:14px 18px; 
      border-radius:12px; 
      font-size:15px; 
      font-weight:500;
      outline:none;
      transition: all .2s;
    }
    
    .search-input:focus{
      border-color:var(--accent); 
      box-shadow: 0 0 0 3px var(--accent-light);
    }
    
    .search-input::placeholder{
      color:var(--text-muted);
    }

    .filter-section{
      max-width:1400px;
      margin:0 auto;
      padding:12px 20px;
      background:#fff;
      border-bottom:1px solid var(--line);
    }
    
    .filter-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    
    .filter-title{
      font-size:13px;
      font-weight:800;
      color:var(--text-muted);
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    
    .toggle-btn{
      border:1px solid var(--line);
      background:#fff;
      padding:6px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
      font-size:12px;
      color:var(--text);
      transition: all .2s;
    }
    
    .toggle-btn:hover{
      border-color:var(--accent);
      color:var(--accent);
    }

    .chip-container{
      display:flex; 
      flex-wrap:wrap; 
      gap:8px;
    }

    .chip{
      border:2px solid var(--line);
      background:#fff;
      color:var(--text-muted);
      padding:8px 16px;
      border-radius:999px;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      user-select:none;
      transition: all .2s;
    }
    
    .chip:hover{
      transform: translateY(-2px); 
      border-color:var(--accent); 
      color:var(--accent);
      box-shadow: var(--shadow);
    }
    
    .chip.active{
      background:var(--accent); 
      border-color:var(--accent); 
      color:#fff;
      box-shadow: 0 4px 12px rgba(230,0,18,.25);
    }

    /* ===== MAIN CONTENT ===== */
    .section-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin:20px 0 12px;
    }
    
    .section-header h2{
      font-size:16px;
      font-weight:800;
      color:var(--text);
      letter-spacing:-.3px;
    }
    
    .meta-info{
      color:var(--text-muted);
      font-size:13px;
      font-weight:600;
    }

    .list-wrapper{
      background:#fff;
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      box-shadow: var(--shadow-lg);
    }

    .scroll-area{
      max-height: calc(100vh - 340px);
      overflow-y: auto;
      padding-right:8px;
    }
    
    .scroll-area::-webkit-scrollbar{
      width:8px;
    }
    
    .scroll-area::-webkit-scrollbar-track{
      background:var(--bg);
      border-radius:8px;
    }
    
    .scroll-area::-webkit-scrollbar-thumb{
      background:var(--line);
      border-radius:8px;
    }
    
    .scroll-area::-webkit-scrollbar-thumb:hover{
      background:var(--text-muted);
    }

    .list-grid{
      display:grid;
      gap:12px;
    }

    /* ===== CARD (ROW) LAYOUT ===== */
    .card{
      background:#fff;
      border:2px solid var(--line);
      border-radius:14px;
      padding:16px 18px;
      transition: all .2s;
      box-shadow: var(--shadow);
    }
    
    .card:hover{
      border-color:var(--accent);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .card-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }

    .card-main{
      flex:1;
      min-width:0;
    }

    .card-maker{
      font-size:11px;
      font-weight:700;
      color:var(--text-muted);
      text-transform:uppercase;
      letter-spacing:.5px;
      margin-bottom:4px;
    }

    .card-model{
      font-size:17px;
      font-weight:900;
      color:var(--text);
      letter-spacing:-.3px;
      line-height:1.3;
      word-break:keep-all;
    }

    .card-price{
      text-align:right;
      font-size:19px;
      font-weight:900;
      color:var(--accent);
      white-space:nowrap;
      font-variant-numeric:tabular-nums;
    }

    .card-body{
      display:grid;
      gap:10px;
      margin-bottom:12px;
    }

    .info-row{
      display:grid;
      grid-template-columns:100px 1fr;
      gap:12px;
      align-items:flex-start;
    }

    .info-label{
      font-size:12px;
      font-weight:800;
      color:var(--text-muted);
      text-transform:uppercase;
      letter-spacing:.3px;
    }

    .info-value{
      font-size:13px;
      font-weight:600;
      color:var(--text);
      word-break:break-word;
    }

    .color-chips{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .color-chip{
      display:inline-flex;
      align-items:center;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--bg);
      font-size:11px;
      font-weight:700;
      color:var(--text);
    }

    .card-footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:8px;
      padding-top:12px;
      border-top:1px solid var(--line);
    }

    .badge-group{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      padding:6px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      font-variant-numeric:tabular-nums;
    }

    .badge.success{
      background:var(--success-light);
      border:1px solid var(--success);
      color:var(--success);
    }

    .badge.primary{
      background:var(--accent2-light);
      border:1px solid var(--accent2);
      color:var(--accent2);
    }

    .badge.normal{
      background:var(--accent-light);
      border:1px solid var(--accent);
      color:var(--accent);
    }

    .btn-copy{
      border:2px solid var(--accent);
      background:#fff;
      color:var(--accent);
      padding:8px 16px;
      border-radius:10px;
      font-weight:800;
      font-size:12px;
      cursor:pointer;
      transition: all .2s;
      white-space:nowrap;
    }

    .btn-copy:hover{
      background:var(--accent);
      color:#fff;
      transform:translateY(-2px);
      box-shadow: 0 4px 12px rgba(230,0,18,.3);
    }

    .empty-state{
      padding:60px 20px;
      text-align:center;
      color:var(--text-muted);
      border:2px dashed var(--line);
      border-radius:14px;
      background:var(--bg);
    }

    .empty-state-icon{
      font-size:48px;
      margin-bottom:12px;
      opacity:.3;
    }

    .empty-state-text{
      font-size:15px;
      font-weight:600;
    }

    /* ===== TOAST ===== */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:30px;
      background:rgba(15,23,42,.95);
      color:#fff;
      padding:12px 20px;
      border-radius:12px;
      font-size:13px;
      font-weight:700;
      box-shadow: var(--shadow-lg);
      display:none;
      z-index:200;
      backdrop-filter:blur(8px);
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px){
      .topbar{
        flex-direction:column;
        align-items:flex-start;
        gap:12px;
      }
      
      .brand{
        width:100%;
        justify-content:space-between;
      }
      
      .status-indicator{
        font-size:11px;
        padding:6px 10px;
      }
      
      .info-row{
        grid-template-columns:80px 1fr;
      }
      
      .card-header{
        flex-direction:column;
      }
      
      .card-price{
        text-align:left;
        font-size:16px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo-container">
          <img class="logoImg" src="https://sspark.genspark.ai/cfimages?u1=rstie8J659kYe%2F3rw%2BRWdFw7pFwBtLCwVzPwcaVZ3L6c7k3MGQYbBrPiHbEx9CbpvFmNd%2FWdeTRpCqyid%2FNRceiaKL8ogK2tHUeY91BPXwOVStrAihTejnvl%2FxjBpNTQ%2FSS0MUTDxMLe&u2=JyaSnzY08g7HjH92&width=512" alt="ë¡¯ë°ë Œí„°ì¹´ ë¡œê³ " />
        </div>
        <div class="title">
          <h1>ë¡¯ë°ë Œí„°ì¹´ ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
          <p>ì „ëµì¬ê³  Â· í˜„ëŒ€ Â· ê¸°ì•„ í†µí•© ê´€ë¦¬</p>
        </div>
      </div>
      <div class="status-indicator loading" id="statusIndicator">
        â³ ë°ì´í„° ë¡œë”©ì¤‘...
      </div>
    </div>

    <div class="filter-section">
      <div class="filter-header">
        <div class="filter-title">ì œì¡°ì‚¬ í•„í„°</div>
      </div>
      <div class="chip-container" id="makerChips">
        <div class="chip active" data-maker="ALL">ì „ì²´</div>
        <div class="chip" data-maker="LOTTE">ë¡¯ë°ë Œí„°ì¹´(ì „ëµì¬ê³ )</div>
        <div class="chip" data-maker="HYUNDAI">í˜„ëŒ€ìë™ì°¨</div>
        <div class="chip" data-maker="KIA">ê¸°ì•„</div>
      </div>
    </div>

    <div class="search-section">
      <input 
        id="searchInput" 
        class="search-input" 
        placeholder="ğŸ” ì°¨ì¢…, ì˜µì…˜, ìƒ‰ìƒìœ¼ë¡œ ê²€ìƒ‰..." 
        autocomplete="off" 
      />
    </div>

    <div class="filter-section">
      <div class="filter-header">
        <div class="filter-title">ì°¨ì¢… í•„í„°</div>
        <button class="toggle-btn" id="toggleModels">ì ‘ê¸°</button>
      </div>
      <div class="chip-container" id="modelChips"></div>
    </div>
  </header>

  <main class="wrap">
    <div class="section-header">
      <h2>ì¬ê³  ë¦¬ìŠ¤íŠ¸</h2>
      <div class="meta-info" id="metaInfo">ë¡œë”©ì¤‘...</div>
    </div>

    <div class="list-wrapper">
      <div class="scroll-area" id="scrollArea">
        <div class="list-grid" id="listGrid"></div>
        <div id="sentinel" style="height:20px"></div>
      </div>
    </div>

    <div style="margin-top:20px; padding:16px; background:var(--accent-light); border-radius:12px; border:1px solid var(--accent);">
      <p style="font-size:13px; font-weight:600; color:var(--accent); line-height:1.6;">
        ğŸ’¡ <strong>Tip:</strong> í…ìŠ¤íŠ¸ë³µì‚¬ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì°¨ì¢…, ì˜µì…˜, ìƒ‰ìƒ, ê°€ê²©, ì¬ê³  ì •ë³´ë¥¼ í•œë²ˆì— ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>
  </main>

  <div class="toast" id="toast"></div>

<script>
// ===== ì°¨ì¢…ëª… í•œê¸€ ë§¤í•‘ í…Œì´ë¸” =====
const MODEL_NAME_MAP = {
  // í˜„ëŒ€
  'AVANTE': 'ì•„ë°˜ë–¼',
  'SONATA': 'ì˜ë‚˜íƒ€',
  'GRANDEUR': 'ê·¸ëœì €',
  'SANTAFE': 'ì‹¸íƒ€í˜',
  'TUCSON': 'íˆ¬ì‹¼',
  'PALISADE': 'íŒ°ë¦¬ì„¸ì´ë“œ',
  'KONA': 'ì½”ë‚˜',
  'VENUE': 'ë² ë‰´',
  'CASPER': 'ìºìŠ¤í¼',
  'STARIA': 'ìŠ¤íƒ€ë¦¬ì•„',
  
  // ê¸°ì•„
  'K3': 'K3',
  'K5': 'K5',
  'K8': 'K8',
  'K9': 'K9',
  'CARNIVAL': 'ì¹´ë‹ˆë°œ',
  'SORENTO': 'ì˜ë Œí† ',
  'SPORTAGE': 'ìŠ¤í¬í‹°ì§€',
  'SELTOS': 'ì…€í† ìŠ¤',
  'NIRO': 'ë‹ˆë¡œ',
  'EV6': 'EV6',
  'EV9': 'EV9',
  'MOHAVE': 'ëª¨í•˜ë¹„',
  'RAY': 'ë ˆì´',
  
  // ê¸°íƒ€
  'ACTYON': 'ì•¡í‹°ì–¸',
  'BMW 5 SERIES': 'BMW 5ì‹œë¦¬ì¦ˆ',
  'BMW X3': 'BMW X3',
  'BMW X5': 'BMW X5'
};

// ===== ì „ì—­ ìƒíƒœ =====
let allData = [];
let filteredData = [];
let renderedCount = 0;
const PAGE_SIZE = 50;

let currentMakerFilter = 'ALL';
let currentModelFilter = 'ALL';
let currentSearchQuery = '';

const elListGrid = document.getElementById('listGrid');
const elMetaInfo = document.getElementById('metaInfo');
const elSearchInput = document.getElementById('searchInput');
const elToast = document.getElementById('toast');
const elMakerChips = document.getElementById('makerChips');
const elModelChips = document.getElementById('modelChips');
const elScrollArea = document.getElementById('scrollArea');
const elStatusIndicator = document.getElementById('statusIndicator');
const elToggleModels = document.getElementById('toggleModels');

let modelsCollapsed = false;

// ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====
function showToast(msg){
  elToast.textContent = msg;
  elToast.style.display = 'block';
  clearTimeout(showToast._t);
  showToast._t = setTimeout(() => elToast.style.display = 'none', 2000);
}

function formatMoney(n){
  if(n == null || n === '') return '-';
  try{ return Number(n).toLocaleString('ko-KR') + 'ì›'; }
  catch{ return String(n); }
}

function safeText(v){
  if(v == null || v === undefined) return '';
  return String(v).trim();
}

function normalizeModelName(name){
  let normalized = safeText(name).toUpperCase();
  // ê´„í˜¸ ì œê±°
  normalized = normalized.replace(/\(.*?\)/g, '').trim();
  return normalized;
}

function getModelDisplayName(name){
  const normalized = normalizeModelName(name);
  return MODEL_NAME_MAP[normalized] || name;
}

// ===== ì—‘ì…€ íŒŒì‹± í•¨ìˆ˜ =====
/**
 * ë¡¯ë° ì „ëµì¬ê³  ì—‘ì…€ íŒŒì‹±
 * í•„ìˆ˜ ì»¬ëŸ¼: ì°¨ì¢…, ì˜µì…˜, ì™¸ì¥ìƒ‰ìƒ, ë‚´ì¥ìƒ‰ìƒ, ê°€ê²©, íŒë§¤ê°€ëŠ¥ì¬ê³ , ì…ê³ ì¬ê³ , ì •ìƒì¬ê³ 
 */
function parseLotteExcel(workbook){
  const results = [];
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  const data = XLSX.utils.sheet_to_json(sheet);
  
  for(const row of data){
    // íŒŒì‹± í¬ì¸íŠ¸: ì‹¤ì œ ì—‘ì…€ ì»¬ëŸ¼ëª…ì— ë§ì¶° ì¡°ì • í•„ìš”
    const model = row['ì°¨ì¢…'] || row['model'] || '';
    if(!model) continue;
    
    results.push({
      maker: 'ë¡¯ë°ë Œí„°ì¹´(ì „ëµì¬ê³ )',
      makerKey: 'LOTTE',
      model: model,
      modelNorm: normalizeModelName(model),
      modelDisplay: getModelDisplayName(model),
      
      trim: row['ì˜µì…˜'] || row['trim'] || '',
      
      exteriorColor: row['ì™¸ì¥ìƒ‰ìƒ'] || row['exterior_color'] || '',
      interiorColor: row['ë‚´ì¥ìƒ‰ìƒ'] || row['interior_color'] || '',
      
      price: parseFloat(row['ê°€ê²©'] || row['price'] || 0),
      
      // ë¡¯ë°ë§Œ í‘œì‹œ: íŒë§¤ê°€ëŠ¥/ì…ê³ /ì •ìƒ
      strategyNow: parseInt(row['íŒë§¤ê°€ëŠ¥ì¬ê³ '] || row['strategy_now'] || 0),
      strategyLater: parseInt(row['ì…ê³ ì¬ê³ '] || row['strategy_later'] || 0),
      normalTotal: parseInt(row['ì •ìƒì¬ê³ '] || row['normal_total'] || 0),
      
      subsidy: parseFloat(row['ì „ê¸°ì°¨ë³´ì¡°ê¸ˆ'] || row['subsidy'] || 0),
      
      // ë³µì‚¬ìš© í•„ë“œ
      salesCode: row['ì°¨ì¢…ì½”ë“œ'] || '',
      optionCode: row['ì˜µì…˜ì½”ë“œ'] || '',
      exteriorCode: row['ì™¸ì¥ì½”ë“œ'] || '',
      interiorCode: row['ë‚´ì¥ì½”ë“œ'] || '',
      location: row['ì¶œí•˜ì¥'] || ''
    });
  }
  
  return results;
}

/**
 * í˜„ëŒ€/ê¸°ì•„ ì¬ê³  ì—‘ì…€ íŒŒì‹±
 * í•„ìˆ˜ ì»¬ëŸ¼: ì°¨ì¢…ëª…, ì°¨ì¢…ì½”ë“œ, ì˜µì…˜ì½”ë“œ, ì˜µì…˜ëª…, ì™¸ì¥ìƒ‰ìƒì½”ë“œ, ì™¸ì¥ìƒ‰ìƒëª…, ë‚´ì¥ìƒ‰ìƒì½”ë“œ, ë‚´ì¥ìƒ‰ìƒëª…, ì¶œê³ ì§€, ì •ìƒì¬ê³ , ê°€ê²©
 */
function parseCarMakerExcel(workbook, makerKey, makerName){
  const results = [];
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  const data = XLSX.utils.sheet_to_json(sheet);
  
  for(const row of data){
    const model = row['ì°¨ì¢…ëª…'] || row['model'] || row['ì°¨ì¢…'] || '';
    if(!model) continue;
    
    const normalTotal = parseInt(row['ì •ìƒì¬ê³ '] || row['normal_total'] || row['ì¬ê³ '] || 0);
    
    results.push({
      maker: makerName,
      makerKey: makerKey,
      model: model,
      modelNorm: normalizeModelName(model),
      modelDisplay: getModelDisplayName(model),
      
      trim: row['ì˜µì…˜ëª…'] || row['trim_options'] || row['ì˜µì…˜'] || '',
      
      exteriorColor: row['ì™¸ì¥ìƒ‰ìƒëª…'] || row['color'] || row['ì™¸ì¥ìƒ‰ìƒ'] || '',
      interiorColor: row['ë‚´ì¥ìƒ‰ìƒëª…'] || row['interior_color'] || row['ë‚´ì¥ìƒ‰ìƒ'] || '',
      
      price: parseFloat(row['ê°€ê²©'] || row['price'] || 0),
      
      // í˜„ëŒ€/ê¸°ì•„ëŠ” ì •ìƒì¬ê³ ë§Œ
      normalTotal: normalTotal,
      
      // ë³µì‚¬ìš© í•„ë“œ
      salesCode: row['ì°¨ì¢…ì½”ë“œ'] || row['sales_code'] || '',
      optionCode: row['ì˜µì…˜ì½”ë“œ'] || row['option_code'] || '',
      exteriorCode: row['ì™¸ì¥ìƒ‰ìƒì½”ë“œ'] || row['color_code'] || '',
      interiorCode: row['ë‚´ì¥ìƒ‰ìƒì½”ë“œ'] || row['interior_code'] || '',
      location: row['ì¶œê³ ì§€'] || row['location'] || row['ì¶œí•˜ì¥'] || ''
    });
  }
  
  return results;
}

// ===== ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ =====
async function loadExcelFile(url){
  try{
    const response = await fetch(url);
    if(!response.ok) throw new Error(`Failed to load ${url}`);
    const arrayBuffer = await response.arrayBuffer();
    return XLSX.read(arrayBuffer, {type: 'array'});
  }catch(e){
    console.error(`Error loading ${url}:`, e);
    return null;
  }
}

async function loadAllData(){
  elStatusIndicator.textContent = 'â³ ë°ì´í„° ë¡œë”©ì¤‘...';
  elStatusIndicator.className = 'status-indicator loading';
  
  const results = [];
  
  // ë¡¯ë° ì „ëµì¬ê³ 
  const lotteWb = await loadExcelFile('./data/lotte.xlsx');
  if(lotteWb){
    results.push(...parseLotteExcel(lotteWb));
  }
  
  // í˜„ëŒ€ ì¬ê³ 
  const hyundaiWb = await loadExcelFile('./data/hyundai.xls');
  if(hyundaiWb){
    results.push(...parseCarMakerExcel(hyundaiWb, 'HYUNDAI', 'í˜„ëŒ€ìë™ì°¨'));
  }
  
  // ê¸°ì•„ ì¬ê³ 
  const kiaWb = await loadExcelFile('./data/kia.xls');
  if(kiaWb){
    results.push(...parseCarMakerExcel(kiaWb, 'KIA', 'ê¸°ì•„'));
  }
  
  if(results.length === 0){
    elStatusIndicator.textContent = 'âš ï¸ ë°ì´í„° ì—†ìŒ';
    elStatusIndicator.className = 'status-indicator';
    elListGrid.innerHTML = `<div class="empty-state">
      <div class="empty-state-icon">ğŸ“‚</div>
      <div class="empty-state-text">ì—‘ì…€ íŒŒì¼ì„ data/ í´ë”ì— ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</div>
    </div>`;
    return;
  }
  
  // ì •ë ¬: ë¡¯ë° ìš°ì„ , ê·¸ ë‹¤ìŒ ì°¨ì¢…ëª…
  results.sort((a, b) => {
    if(a.makerKey === 'LOTTE' && b.makerKey !== 'LOTTE') return -1;
    if(a.makerKey !== 'LOTTE' && b.makerKey === 'LOTTE') return 1;
    return a.modelDisplay.localeCompare(b.modelDisplay, 'ko');
  });
  
  allData = results;
  buildModelChips();
  applyFilters();
  
  elStatusIndicator.textContent = `âœ… ${results.length.toLocaleString()}ê±´ ë¡œë“œ ì™„ë£Œ`;
  elStatusIndicator.className = 'status-indicator success';
}

// ===== ì°¨ì¢… í•„í„° ì¹© ìƒì„± (ì¤‘ë³µ ì œê±°) =====
function buildModelChips(){
  const modelSet = new Set();
  
  for(const item of allData){
    if(currentMakerFilter !== 'ALL' && item.makerKey !== currentMakerFilter) continue;
    modelSet.add(item.modelDisplay);
  }
  
  const models = Array.from(modelSet).sort((a, b) => a.localeCompare(b, 'ko'));
  
  elModelChips.innerHTML = '';
  
  const allChip = document.createElement('div');
  allChip.className = 'chip' + (currentModelFilter === 'ALL' ? ' active' : '');
  allChip.dataset.model = 'ALL';
  allChip.textContent = 'ì°¨ì¢… ì „ì²´';
  elModelChips.appendChild(allChip);
  
  for(const model of models){
    const chip = document.createElement('div');
    chip.className = 'chip' + (currentModelFilter === model ? ' active' : '');
    chip.dataset.model = model;
    chip.textContent = model;
    elModelChips.appendChild(chip);
  }
}

// ===== í•„í„° ì ìš© =====
function applyFilters(){
  const query = currentSearchQuery.toLowerCase();
  
  filteredData = allData.filter(item => {
    // ì œì¡°ì‚¬ í•„í„°
    if(currentMakerFilter !== 'ALL' && item.makerKey !== currentMakerFilter) return false;
    
    // ì°¨ì¢… í•„í„°
    if(currentModelFilter !== 'ALL' && item.modelDisplay !== currentModelFilter) return false;
    
    // ê²€ìƒ‰ì–´ í•„í„°
    if(query){
      const searchText = [
        item.modelDisplay,
        item.trim,
        item.exteriorColor,
        item.interiorColor,
        item.salesCode,
        item.optionCode
      ].join(' ').toLowerCase();
      
      if(!searchText.includes(query)) return false;
    }
    
    return true;
  });
  
  renderedCount = 0;
  elListGrid.innerHTML = '';
  renderMore(true);
  
  const total = filteredData.length;
  elMetaInfo.textContent = `ì´ ${total.toLocaleString()}ê±´ (í˜„ì¬ ${Math.min(total, renderedCount).toLocaleString()}ê±´ í‘œì‹œ)`;
  
  if(total === 0){
    elListGrid.innerHTML = `<div class="empty-state">
      <div class="empty-state-icon">ğŸ”</div>
      <div class="empty-state-text">ì¡°ê±´ì— ë§ëŠ” ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</div>
    </div>`;
  }
}

// ===== ì¹´ë“œ(í–‰) ë Œë”ë§ =====
function createCard(item, index){
  const card = document.createElement('div');
  card.className = 'card';
  
  // í—¤ë”
  const header = document.createElement('div');
  header.className = 'card-header';
  
  const main = document.createElement('div');
  main.className = 'card-main';
  
  const maker = document.createElement('div');
  maker.className = 'card-maker';
  maker.textContent = item.maker;
  
  const model = document.createElement('div');
  model.className = 'card-model';
  model.textContent = item.modelDisplay;
  
  main.appendChild(maker);
  main.appendChild(model);
  
  const price = document.createElement('div');
  price.className = 'card-price';
  price.textContent = formatMoney(item.price);
  
  header.appendChild(main);
  header.appendChild(price);
  
  // ë°”ë””
  const body = document.createElement('div');
  body.className = 'card-body';
  
  // ì˜µì…˜
  if(item.trim){
    const trimRow = document.createElement('div');
    trimRow.className = 'info-row';
    trimRow.innerHTML = `
      <div class="info-label">ì˜µì…˜</div>
      <div class="info-value">${safeText(item.trim)}</div>
    `;
    body.appendChild(trimRow);
  }
  
  // ì™¸ì¥ìƒ‰ìƒ
  if(item.exteriorColor){
    const extRow = document.createElement('div');
    extRow.className = 'info-row';
    extRow.innerHTML = `
      <div class="info-label">ì™¸ì¥ìƒ‰ìƒ</div>
      <div class="info-value">${safeText(item.exteriorColor)}</div>
    `;
    body.appendChild(extRow);
  }
  
  // ë‚´ì¥ìƒ‰ìƒ
  if(item.interiorColor){
    const intRow = document.createElement('div');
    intRow.className = 'info-row';
    intRow.innerHTML = `
      <div class="info-label">ë‚´ì¥ìƒ‰ìƒ</div>
      <div class="info-value">${safeText(item.interiorColor)}</div>
    `;
    body.appendChild(intRow);
  }
  
  // ë³´ì¡°ê¸ˆ (ì „ê¸°ì°¨)
  if(item.subsidy && item.subsidy > 0){
    const subsidyRow = document.createElement('div');
    subsidyRow.className = 'info-row';
    subsidyRow.innerHTML = `
      <div class="info-label">ë³´ì¡°ê¸ˆ</div>
      <div class="info-value">${formatMoney(item.subsidy)}</div>
    `;
    body.appendChild(subsidyRow);
  }
  
  // ì¶œí•˜ì¥/ì¶œê³ ì§€
  if(item.location){
    const locRow = document.createElement('div');
    locRow.className = 'info-row';
    locRow.innerHTML = `
      <div class="info-label">ì¶œí•˜ì¥</div>
      <div class="info-value">${safeText(item.location)}</div>
    `;
    body.appendChild(locRow);
  }
  
  // í‘¸í„°
  const footer = document.createElement('div');
  footer.className = 'card-footer';
  
  const badgeGroup = document.createElement('div');
  badgeGroup.className = 'badge-group';
  
  // ì¬ê³  ë°°ì§€
  if(item.makerKey === 'LOTTE'){
    // ë¡¯ë°: íŒë§¤ê°€ëŠ¥/ì…ê³ /ì •ìƒ
    const nowBadge = document.createElement('span');
    nowBadge.className = 'badge success';
    nowBadge.textContent = `íŒë§¤ê°€ëŠ¥ ${item.strategyNow || 0}ëŒ€`;
    badgeGroup.appendChild(nowBadge);
    
    const laterBadge = document.createElement('span');
    laterBadge.className = 'badge primary';
    laterBadge.textContent = `ì…ê³  ${item.strategyLater || 0}ëŒ€`;
    badgeGroup.appendChild(laterBadge);
    
    const normalBadge = document.createElement('span');
    normalBadge.className = 'badge normal';
    normalBadge.textContent = `ì •ìƒ ${item.normalTotal || 0}ëŒ€`;
    badgeGroup.appendChild(normalBadge);
  }else{
    // í˜„ëŒ€/ê¸°ì•„: ì •ìƒì¬ê³ ë§Œ
    const normalBadge = document.createElement('span');
    normalBadge.className = 'badge normal';
    normalBadge.textContent = `ì •ìƒì¬ê³  ${item.normalTotal || 0}ëŒ€`;
    badgeGroup.appendChild(normalBadge);
  }
  
  footer.appendChild(badgeGroup);
  
  // ë³µì‚¬ ë²„íŠ¼
  const copyBtn = document.createElement('button');
  copyBtn.className = 'btn-copy';
  copyBtn.textContent = 'ğŸ“‹ í…ìŠ¤íŠ¸ë³µì‚¬';
  copyBtn.addEventListener('click', () => copyItemText(item));
  
  footer.appendChild(copyBtn);
  
  // ì¡°ë¦½
  card.appendChild(header);
  card.appendChild(body);
  card.appendChild(footer);
  
  return card;
}

function renderMore(fromTop = false){
  if(fromTop) elScrollArea.scrollTop = 0;
  
  const total = filteredData.length;
  const nextCount = Math.min(total, renderedCount + PAGE_SIZE);
  
  for(let i = renderedCount; i < nextCount; i++){
    elListGrid.appendChild(createCard(filteredData[i], i));
  }
  
  renderedCount = nextCount;
  elMetaInfo.textContent = `ì´ ${total.toLocaleString()}ê±´ (í˜„ì¬ ${renderedCount.toLocaleString()}ê±´ í‘œì‹œ)`;
}

// ===== ë³µì‚¬ ê¸°ëŠ¥ =====
function copyItemText(item){
  // í¬ë§· 1: ì¹´ë©”ì´ì»¤, ì°¨ì¢…ì½”ë“œ, ì˜µì…˜ì½”ë“œ, ì™¸ì¥ì½”ë“œ, ë‚´ì¥ì½”ë“œ, ì¶œí•˜ì¥
  const format1 = [
    item.maker,
    item.salesCode,
    item.optionCode,
    item.exteriorCode,
    item.interiorCode,
    item.location
  ].map(v => safeText(v) || '-').join(', ');
  
  // í¬ë§· 2: ì°¨ì¢…: [ì°¨ì¢…ëª…] ì˜µì…˜: [ì˜µì…˜ëª…] ì™¸ì¥ìƒ‰ìƒ/ë‚´ì¥ìƒ‰ìƒ: [ìƒ‰ìƒ]
  const format2 = `ì°¨ì¢…: ${item.modelDisplay} | ì˜µì…˜: ${item.trim || '-'} | ì™¸ì¥ìƒ‰ìƒ/ë‚´ì¥ìƒ‰ìƒ: ${item.exteriorColor || '-'}/${item.interiorColor || '-'}`;
  
  // ê²°í•©
  const text = `${format1}\n${format2}`;
  
  navigator.clipboard.writeText(text).then(() => {
    showToast('âœ… ë³µì‚¬ ì™„ë£Œ!');
  }).catch(err => {
    // fallback
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    ta.remove();
    showToast('âœ… ë³µì‚¬ ì™„ë£Œ!');
  });
}

// ===== ë¬´í•œ ìŠ¤í¬ë¡¤ =====
const io = new IntersectionObserver(entries => {
  if(entries.some(e => e.isIntersecting)){
    if(renderedCount < filteredData.length){
      renderMore(false);
    }
  }
}, {root: elScrollArea, threshold: 0.5});

io.observe(document.getElementById('sentinel'));

// ===== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ =====
elMakerChips.addEventListener('click', e => {
  const chip = e.target.closest('.chip');
  if(!chip) return;
  
  currentMakerFilter = chip.dataset.maker;
  
  for(const c of elMakerChips.querySelectorAll('.chip')){
    c.classList.toggle('active', c === chip);
  }
  
  // ì°¨ì¢… í•„í„° ì´ˆê¸°í™”
  currentModelFilter = 'ALL';
  buildModelChips();
  applyFilters();
});

elModelChips.addEventListener('click', e => {
  const chip = e.target.closest('.chip');
  if(!chip) return;
  
  currentModelFilter = chip.dataset.model;
  
  for(const c of elModelChips.querySelectorAll('.chip')){
    c.classList.toggle('active', c === chip);
  }
  
  applyFilters();
});

elSearchInput.addEventListener('input', e => {
  currentSearchQuery = e.target.value;
  applyFilters();
});

elToggleModels.addEventListener('click', () => {
  modelsCollapsed = !modelsCollapsed;
  elModelChips.style.display = modelsCollapsed ? 'none' : 'flex';
  elToggleModels.textContent = modelsCollapsed ? 'í¼ì¹˜ê¸°' : 'ì ‘ê¸°';
});

// ===== ì´ˆê¸°í™” =====
loadAllData();
</script>
</body>
</html>
